<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tutorial · NighttimeLights.jl</title><script data-outdated-warner src="assets/warner.js"></script><link rel="canonical" href="https://ayushpatnaikgit.github.io/NighttimeLights.jl/tutorial.html"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">NighttimeLights.jl</a></span></div><form class="docs-search" action="search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="index.html">Home</a></li><li><a class="tocitem" href="concepts.html">Basic concepts</a></li><li><a class="tocitem" href="polygons.html">Polygons and shapefiles</a></li><li><a class="tocitem" href="data_cleaning.html">Data Cleaning</a></li><li class="is-active"><a class="tocitem" href="tutorial.html">Tutorial</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Cleaning-Data"><span>Cleaning Data</span></a></li><li class="toplevel"><a class="tocitem" href="#Generating-Aggregates"><span>Generating Aggregates</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href="tutorial.html">Tutorial</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="tutorial.html">Tutorial</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/ayushpatnaikgit/NighttimeLights.jl/blob/master/docs/src/tutorial.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Tutorial"><a class="docs-heading-anchor" href="#Tutorial">Tutorial</a><a id="Tutorial-1"></a><a class="docs-heading-anchor-permalink" href="#Tutorial" title="Permalink"></a></h1><p>The following example demonstrates how to use nighttime lights data for research. First the dataset is cleaned and then aggregate of polygons are produced. The following tutorial shows the cleaning procedure for nighttime lights of a box around Mumbai and then the time series of aggregate radiance for each district of Mumbai is generated. The radiance and cloud-free observations datacubes for Mumbai and the district level shapefiles for Mumbai can be downloaded from <a href="https://github.com/JuliaPlanet/NighttimeLights.jl/tree/main/assets">assets provided with the package</a></p><h1 id="Cleaning-Data"><a class="docs-heading-anchor" href="#Cleaning-Data">Cleaning Data</a><a id="Cleaning-Data-1"></a><a class="docs-heading-anchor-permalink" href="#Cleaning-Data" title="Permalink"></a></h1><h5 id=".-Load-datasets"><a class="docs-heading-anchor" href="#.-Load-datasets">1. Load datasets</a><a id=".-Load-datasets-1"></a><a class="docs-heading-anchor-permalink" href="#.-Load-datasets" title="Permalink"></a></h5><article class="docstring"><header><a class="docstring-binding" id="NighttimeLights.load_example-Tuple{}" href="#NighttimeLights.load_example-Tuple{}"><code>NighttimeLights.load_example</code></a> — <span class="docstring-category">Method</span></header><section><div><p>The datacubes and the district level shapefile for Mumbai city are provided with the package as examples. These can be loaded using the function. The radiance datacube, cloud-free observations datacube and the shapefile of Mumbai districts are loaded as global variables. </p><p></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ayushpatnaikgit/NighttimeLights.jl/blob/1fbc60d96dad4ededbbe0ed7c7694b39dde6d7c4/src/example.jl#L1-L5">source</a></section></article><pre><code class="nohighlight">i) Distict level shapefile of Mumbai is loaded as mumbai_map. 
ii) Radiance datacube of Mumbai is loaded as radiance_datacube. 
iii) Cloud-free observations data is loaded as clouds_datacube. 
iv) MUMBAI_COORDINATE_SYSTEM should be used as the coordinate system. </code></pre><h5 id=".-Replace-observations-with-0-cloud-free-observations-with-NaN."><a class="docs-heading-anchor" href="#.-Replace-observations-with-0-cloud-free-observations-with-NaN.">2. Replace observations with 0 cloud-free observations with NaN.</a><a id=".-Replace-observations-with-0-cloud-free-observations-with-NaN.-1"></a><a class="docs-heading-anchor-permalink" href="#.-Replace-observations-with-0-cloud-free-observations-with-NaN." title="Permalink"></a></h5><p>Monthly averages with 0 measurements are marked as 0 in the radiance datacube, they should be NaN. </p><pre><code class="language-julia">radiance_datacube = mark_nan(radiance_datacube, clouds_datacube) </code></pre><h5 id=".-Replace-all-values-below-0-with-NaN"><a class="docs-heading-anchor" href="#.-Replace-all-values-below-0-with-NaN">3. Replace all values below 0 with NaN</a><a id=".-Replace-all-values-below-0-with-NaN-1"></a><a class="docs-heading-anchor-permalink" href="#.-Replace-all-values-below-0-with-NaN" title="Permalink"></a></h5><p>There are negative values in the data due to cleaning procedure by NOAA. They should be replaced by NaN. </p><pre><code class="language-julia">radiance_datacube = replace!(x -&gt; x &lt; 0 ? NaN : x, radiance_datacube) </code></pre><h5 id=".-Generate-a-background-noise-mask."><a class="docs-heading-anchor" href="#.-Generate-a-background-noise-mask.">4. Generate a background noise mask.</a><a id=".-Generate-a-background-noise-mask.-1"></a><a class="docs-heading-anchor-permalink" href="#.-Generate-a-background-noise-mask." title="Permalink"></a></h5><p>All the pixels below 0.4 in the annual image of the 12 months of the data will be considered background noise. A different threshold can be chosen. </p><pre><code class="nohighlight">noise = background_noise_mask(datacube, clouds_datacube, 0.4)
radiance_datacube = apply_mask(datacube, noise)</code></pre><p>All the pixels considered dark in the noise mask have all observations marked as 0 in the datacube.</p><h5 id=".-Generate-an-outlier-mask."><a class="docs-heading-anchor" href="#.-Generate-an-outlier-mask.">5. Generate an outlier mask.</a><a id=".-Generate-an-outlier-mask.-1"></a><a class="docs-heading-anchor-permalink" href="#.-Generate-an-outlier-mask." title="Permalink"></a></h5><p>The noise_mask is used as a parameter, so only the pixels considered lit are used to estimating the outliers pixels. </p><pre><code class="nohighlight">stable_pixels = outlier_mask(radiance_datacube, noise)
radiance_datacube = apply_mask(datacube, stable_pixels)</code></pre><p>All the pixels considered outliers have all observations marked as 0 in the datacube.</p><h5 id=".-Remove-outlier-observations-from-the-remaining-pixels."><a class="docs-heading-anchor" href="#.-Remove-outlier-observations-from-the-remaining-pixels.">6. Remove outlier observations from the remaining pixels.</a><a id=".-Remove-outlier-observations-from-the-remaining-pixels.-1"></a><a class="docs-heading-anchor-permalink" href="#.-Remove-outlier-observations-from-the-remaining-pixels." title="Permalink"></a></h5><pre><code class="nohighlight">radiance_datacube = long_apply(outlier_ts, datacube)</code></pre><p>The <code>long_apply</code> function applies the outlier_ts function on each pixel. This removal outlier observations from pixels which are useful. </p><h5 id=".-Correct-of-attenuation-due-to-clouds"><a class="docs-heading-anchor" href="#.-Correct-of-attenuation-due-to-clouds">7. Correct of attenuation due to clouds</a><a id=".-Correct-of-attenuation-due-to-clouds-1"></a><a class="docs-heading-anchor-permalink" href="#.-Correct-of-attenuation-due-to-clouds" title="Permalink"></a></h5><pre><code class="language-julia">mask = noise .* stable_pixels # Mask of pixels with are lit and aren&#39;t outliers. 
radiance_datacube = bias_correction(radiance_datacube, clouds_datacube, mask)</code></pre><p>Attenuation correction is only done on pixels which are considered lit in both the outlier mask and the noise mask. </p><h5 id=".-Use-linear-interpolation-to-fill-the-NaNs."><a class="docs-heading-anchor" href="#.-Use-linear-interpolation-to-fill-the-NaNs.">8. Use linear interpolation to fill the NaNs.</a><a id=".-Use-linear-interpolation-to-fill-the-NaNs.-1"></a><a class="docs-heading-anchor-permalink" href="#.-Use-linear-interpolation-to-fill-the-NaNs." title="Permalink"></a></h5><pre><code class="language-julia">radiance_datacube = long_apply(linear_interpolation, radiance_datacube)</code></pre><p>Even though this is done for all pixels, the ones considered dark in the mask will be zero. </p><h1 id="Generating-Aggregates"><a class="docs-heading-anchor" href="#Generating-Aggregates">Generating Aggregates</a><a id="Generating-Aggregates-1"></a><a class="docs-heading-anchor-permalink" href="#Generating-Aggregates" title="Permalink"></a></h1><h5 id=".-Make-a-coordinate-system-of-Mumbai."><a class="docs-heading-anchor" href="#.-Make-a-coordinate-system-of-Mumbai.">1. Make a coordinate system of Mumbai.</a><a id=".-Make-a-coordinate-system-of-Mumbai.-1"></a><a class="docs-heading-anchor-permalink" href="#.-Make-a-coordinate-system-of-Mumbai." title="Permalink"></a></h5><p>The top left pixel of the box around Mumbai datacube, which we have used so far, have coordinates (19.49907,72.721252). The bottom right pixel&#39;s coordinates are (18.849475, 73.074187). There are 156 rows and 85 columns in the datacube. The number of months of data doesn&#39;t matter in calculating the coordinate system.  </p><pre><code class="language-julia">MUMBAI_COORDINATE_SYSTEM = CoordinateSystem(Coordinate(19.49907,72.721252), (18.849475, 73.074187), 156, 85)</code></pre><p>This coordinate system is predefined, you can just use the global variable <code>MUMBAI_COORDINATE_SYSTEM</code>. </p><h5 id=".-Load-the-shape-file-for-the-districts-of-Mumbai."><a class="docs-heading-anchor" href="#.-Load-the-shape-file-for-the-districts-of-Mumbai.">2. Load the shape file for the districts of Mumbai.</a><a id=".-Load-the-shape-file-for-the-districts-of-Mumbai.-1"></a><a class="docs-heading-anchor-permalink" href="#.-Load-the-shape-file-for-the-districts-of-Mumbai." title="Permalink"></a></h5><p><a href="https://github.com/JuliaPlanet/NighttimeLights.jl/tree/main/assets/mumbai_map">The district level shapefile of Mumbai</a>  These have been downloaded from datameet. </p><pre><code class="language-julia">mumbai_map = load_shapefile(&quot;assets/mumbai_map/mumbai_districts.shp&quot;)</code></pre><p>The shapefile has a column called DISTRICT. For each district, the name of the district is shown in this column. Will be used this column as column names of the dataset that we&#39;ll generate in the next step. We could have also used census code or any other column with unique names. </p><h5 id=".-Generate-the-time-series-of-aggregate-radiance-for-each-district-of-Mumbai."><a class="docs-heading-anchor" href="#.-Generate-the-time-series-of-aggregate-radiance-for-each-district-of-Mumbai.">3. Generate the time series of aggregate radiance for each district of Mumbai.</a><a id=".-Generate-the-time-series-of-aggregate-radiance-for-each-district-of-Mumbai.-1"></a><a class="docs-heading-anchor-permalink" href="#.-Generate-the-time-series-of-aggregate-radiance-for-each-district-of-Mumbai." title="Permalink"></a></h5><pre><code class="language-julia">mumbai_district_ntl = aggregate_dataframe(MUMABI_COORDINATE_SYSTEM, radiance_datacube, mumbai_map, &quot;DISTRICT&quot;)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="data_cleaning.html">« Data Cleaning</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Friday 23 July 2021 11:31">Friday 23 July 2021</span>. Using Julia version 1.4.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
